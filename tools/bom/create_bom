#!/usr/bin/env python
import os, sys, time, parts_db, bom

def html_header(f):
    f.write("""<html>
<head>
<title>Student Robotics Bill of Materials for ...</title>
<style>
td {
  border-style: solid none none none;
  border-width: 1px;
}
</style>
</head>
<body>
<p>Generated on %s with %s.</p>
<table style="border-style:none;border-spacing:0;">
<tr>
<th>srcode</th>
<th>Description</th>
<th>Distributer</th>
<th>Distributor Order Number</th>
<th>Quantity</th>
<th>Designators</th>
</tr>
""" % (time.asctime(), os.path.basename(sys.argv[0])) )

def html_footer(f):
    f.write("""</body>
</html>""")

if len(sys.argv) < 3:
    print "Usage: %s SCHEMATIC OUTFILE" % (os.path.basename(sys.argv[0]))
    print "Where:"
    print "	- SCHEMATIC is the schematic to read from"
    print "	- OUTFILE is the output HTML file"
    sys.exit(1)

[SCHEMATIC, OUTFILE] = sys.argv[1:3]

schem_name = os.path.basename( SCHEMATIC )

lib = parts_db.Db(bom.PARTS_DB)
parts = bom.BoardBom(lib, SCHEMATIC, schem_name)
outf = open( OUTFILE, "w" )

html_header(outf)

for line in parts.values():
    outf.write("<tr>")
    p = line.part

    if p["sr-code"] == "sr-nothing":
        "Ignore sr-nothing -- we don't want it in HTML BOMs"
        continue

    for x in [ p["sr-code"],
               p["description"],
               p["supplier"],
               p["order-number"],
               len(line),
               ", ".join([x[1] for x in line])
               ]:
        outf.write("<td>%s</td>" % x)

    outf.write("</tr>")

html_footer(outf)
